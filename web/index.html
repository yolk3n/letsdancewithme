<body>
  <h1>ğŸ’ƒ Let's Dance With Me</h1>

  <div class="card" id="user">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</div>

  <div class="card">
    <h3>Ğ£Ñ€Ğ¾ĞºĞ¸</h3>
    <button onclick="doLesson(1)">Ğ£Ñ€Ğ¾Ğº 1</button>
    <button onclick="doLesson(2)">Ğ£Ñ€Ğ¾Ğº 2</button>
    <button onclick="doLesson(3)">Ğ£Ñ€Ğ¾Ğº 3</button>
    <button onclick="doLesson(4)">Ğ£Ñ€Ğ¾Ğº 4 ğŸ”’</button>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();

    const user = tg.initDataUnsafe.user;
    const el = document.getElementById("user");

    function getLevel(xp) {
      if (xp >= 60) return "ğŸ’ƒ Ğ¢Ğ°Ğ½Ñ†Ğ¾Ñ€";
      if (xp >= 30) return "ğŸ¥‹ Ğ£Ñ‡ĞµĞ½Ğ¸Ğº";
      return "ğŸŒ± ĞĞ¾Ğ²Ğ¸Ñ‡Ğ¾Ğº";
    }

    function loadUser() {
      fetch(`/api/user/${user.id}`)
        .then((res) => res.json())
        .then((data) => {
          el.innerHTML = `
            <b>${user.first_name}</b><br/>
            â­ XP: ${data.xp}<br/>
            ğŸ… Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ: ${getLevel(data.xp)}<br/>
            ğŸ“š Ğ£Ñ€Ğ¾ĞºĞ¾Ğ² Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½Ğ¾: ${data.lessons_completed}
          `;
        });
    }

    function doLesson(n) {
      fetch("/api/lesson", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          telegramId: user.id,
          lessonNumber: n,
        }),
      })
        .then((res) => res.json())
        .then((data) => {
          if (data.blocked) {
            alert("ğŸ”’ Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ Ğ¿Ğ¾ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞµ");
          }
          loadUser();
        });
    }

    loadUser();
  </script>
</body>

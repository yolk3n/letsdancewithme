<script>
  const tg = window.Telegram.WebApp;
  tg.ready();

  const user = tg.initDataUnsafe.user;
  const el = document.getElementById("user");

  if (!user) {
    el.innerText = "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Telegram";
  } else {
    fetch(`/api/user/${user.id}`)
      .then((res) => res.json())
      .then((data) => {
        el.innerHTML = `
          <b>ĞŸÑ€Ğ¸Ğ²ĞµÑ‚, ${user.first_name}!</b><br/><br/>
          â­ XP: ${data.xp}<br/>
          ğŸ… Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ: ${getLevel(data.xp)}<br/>
          ğŸ“š ĞŸÑ€Ğ¾Ğ¹Ğ´ĞµĞ½Ğ¾ ÑƒÑ€Ğ¾ĞºĞ¾Ğ²: ${data.lessons_completed}
        `;
      })
      .catch(() => {
        el.innerText = "ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ";
      });
  }

  function getLevel(xp) {
    if (xp >= 60) return "ğŸ’ƒ Ğ¢Ğ°Ğ½Ñ†Ğ¾Ñ€";
    if (xp >= 30) return "ğŸ¥‹ Ğ£Ñ‡ĞµĞ½Ğ¸Ğº";
    return "ğŸŒ± ĞĞ¾Ğ²Ğ¸Ñ‡Ğ¾Ğº";
  }
</script>

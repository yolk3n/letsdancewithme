<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>Let's Dance With Me</title>

    <!-- Telegram Mini App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
      body {
        font-family: Arial, sans-serif;
        background: #111;
        color: #fff;
        padding: 20px;
        margin: 0;
      }

      h1 {
        margin-top: 0;
      }

      .card {
        background: #1e1e1e;
        padding: 16px;
        border-radius: 12px;
        margin-bottom: 16px;
      }

      button {
        width: 100%;
        padding: 12px;
        margin-top: 8px;
        font-size: 16px;
        border-radius: 8px;
        border: none;
        background: #ff4d6d;
        color: #fff;
        cursor: pointer;
      }

      button:active {
        background: #e03a58;
      }

      .error {
        color: #ff8080;
      }
    </style>
  </head>

  <body>
  <h1>üíÉ Let's Dance With Me</h1>

  <div class="card" id="screen"></div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    const screen = document.getElementById("screen");

    // —Å—Ç–∞—Ä—Ç—É–µ–º —Å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π
    loadTeachers();

    function loadTeachers() {
      screen.innerHTML = "<b>–í—ã–±–µ—Ä–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</b><br/><br/>–ó–∞–≥—Ä—É–∑–∫–∞...";
      fetch("/api/teachers")
        .then((res) => res.json())
        .then((teachers) => {
          screen.innerHTML =
            "<b>–í—ã–±–µ—Ä–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</b><br/><br/>" +
            teachers
              .map(
                (t) => `
                  <button onclick="loadCourses(${t.id})">
                    ${t.name}<br/>
                    <small>${t.description}</small>
                  </button>
                `
              )
              .join("");
        })
        .catch(() => {
          screen.innerHTML = "‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π";
        });
    }

    function loadCourses(teacherId) {
      screen.innerHTML = "–ó–∞–≥—Ä—É–∑–∫–∞ –∫—É—Ä—Å–æ–≤...";
      fetch(`/api/courses/${teacherId}`)
        .then((res) => res.json())
        .then((courses) => {
          screen.innerHTML =
            "<b>–ö—É—Ä—Å—ã</b><br/><br/>" +
            courses
              .map(
                (c) => `
                  <button onclick="openCourse(${c.id})">
                    ${c.title}<br/>
                    <small>${c.description}</small>
                  </button>
                `
              )
              .join("") +
            `<br/><button onclick="loadTeachers()">‚¨Ö –ù–∞–∑–∞–¥</button>`;
        })
        .catch(() => {
          screen.innerHTML = "‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—Å–æ–≤";
        });
    }

    function openCourse(courseId) {
      tg.showAlert("–ö—É—Ä—Å –≤—ã–±—Ä–∞–Ω. –£—Ä–æ–∫–∏ ‚Äî —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ üòâ");
    }

    window.loadCourses = loadCourses;
    window.loadTeachers = loadTeachers;
    window.openCourse = openCourse;
  </script>
</body>
</html>
